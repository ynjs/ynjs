var YNWebSocket;(()=>{"use strict";var t={d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>u});var o=function(t,e,o,n){void 0===o&&(o=-1),void 0===n&&(n=!0),this.handler=t,this.time=o,this.context=e,this.autoRemove=n};const n=function(){function t(){this._events=new Map}return t.prototype.get=function(t){return this._events.get(t)},t.prototype.set=function(t,e){return this._events.set(t,e)},t.prototype.add=function(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=-1);var s=this.get(t),i=new o(e,n,r);return s?s.push(i):this.set(t,[i]),this},t.prototype.off=function(t,e){var o=this.get(t);return o&&o.length&&(e?this.set(t,o.filter((function(t){return t.handler==e}))):this.set(t,[])),this},t.prototype.on=function(t,e,o){return this.add(t,e,o)},t.prototype.once=function(t,e,o){return this.add(t,e,o,1)},t.prototype.emit=function(t){for(var e=this,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];for(var r=t.split(":"),s=r.length;s>0;s--){var i=this.get(r.slice(0,s).join(":"))||[];i.forEach((function(t){t.handler.apply(t.context||e,o),t.time>1&&t.time--})),this.set(t,i.filter((function(t){return 0===t.time&&t.autoRemove})))}return this},t.prototype.destory=function(){this._events.clear()},t}();var r,s=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=function(t,e){for(var o=0,n=e.length,r=t.length;o<n;o++,r++)t[r]=e[o];return t};"WebSocket"in window||console.error("WebSocket no supper");var c=function(){function t(){this.protocol="",this.autoOpen=!0,this.reconnectInterval=1e3,this.maxReconnectInterval=3e4,this.reconnectDecay=1.5,this.timeoutInterval=2e3,this.maxReconnectAttempts=null,this.binaryType="blob"}return t.prototype.merge=function(t){if(!t)return this;!1===t.autoOpen&&(this.autoOpen=!1),!0===t.autoOpen&&(this.autoOpen=!0)},t}();const u=function(t){function e(e,o){var n=t.call(this)||this;return n.isDebug=!1,n.protocol="",n.reconnectAttempts=0,n.socket=null,n.option=new c,n.forcedClose=!1,n.url=e,n.option.merge(o),1==n.option.autoOpen&&n.open(),n}return s(e,t),e.prototype.log=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];this.isDebug||e.debugAll?console.log.apply(console,t):this.emit.apply(this,i(["log"],t))},e.prototype.debug=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];(this.isDebug||e.debugAll)&&console.debug.apply(console,t)},e.prototype.close=function(){this.socket&&(this.forcedClose=!0,this.socket.close(1e3,"正常关闭"),this.once("close",(function(){})))},e.prototype.send=function(t){var e=this;return this.socket&&this.socket.readyState===WebSocket.OPEN?(this.debug("ReconnectingWebSocket","send",this.url,t),this.socket.send(t),Promise.resolve(this.socket)):this.open().then((function(o){console.debug("ReconnectingWebSocket","send",e.url,t),e.socket&&e.socket.send(t)}))},e.prototype.sendnow=function(t){if(this.socket&&this.socket.readyState===WebSocket.OPEN)return this.socket.send(t);throw"发送失败，socket 未准备好"},e.prototype.open=function(){var t,e=this;return(t=this.url,new Promise((function(e,o){try{var n=new WebSocket(t,undefined);n.onopen=function(t){console.log("onopen"),e(n)},n.onclose=function(t){return console.log("onclose")},n.onmessage=function(t){return console.log("onmessage")},n.onerror=function(t){return console.log("onerror")}}catch(t){o(t)}}))).then((function(t){return e.socket=t,e.emit("open"),t.onmessage=function(t){e.emit("message",t)},t.onclose=function(t){return e.onsocketclose()},t.onerror=function(t){return e.onsocketclose()},e.socket}))},e.prototype.onsocketclose=function(){var t=this;if(this.socket){if(this.forcedClose)return this.forcedClose=!1,this.socket.onmessage=null,this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,void(this.socket=null);if(this.socket.readyState===WebSocket.CLOSED){if(this.option.maxReconnectAttempts){if(this.reconnectAttempts>this.option.maxReconnectAttempts)return void this.log("超过最大连接次数");this.reconnectAttempts++}this.open().then((function(){t.emit("reconnent")}))}}},e.debugAll=!1,e}(n);YNWebSocket=e})();
//# sourceMappingURL=yn-WebSocket.js.map